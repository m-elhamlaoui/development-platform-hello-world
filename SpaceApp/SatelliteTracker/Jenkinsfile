pipeline {
  agent any

  environment {
    IMAGE_NAME = 'youssefbouraoui1/django-service:latest'
  }

  stages {
    stage('Build & Push Images') {
      steps {
        withCredentials([usernamePassword(credentialsId: 'dockerhub-creds', usernameVariable: 'DOCKERHUB_USER', passwordVariable: 'DOCKERHUB_TOKEN')]) {
          sh "echo $DOCKERHUB_TOKEN | docker login -u $DOCKERHUB_USER --password-stdin"
          dir('SpaceApp/SatelliteTracker') {
            echo 'üî® Building backend Docker image...'
            sh "docker build -t ${IMAGE_NAME} ."
            sh "docker push ${IMAGE_NAME}"
          }
          // Optional: log out from Docker Hub for security
          sh "docker logout"
        }
      }
    }
  }

  post {
    success {
      echo '‚úÖ Backend image built successfully!'
    }
    failure {
      echo '‚ùå Backend image build failed!'
    }
  }
}
